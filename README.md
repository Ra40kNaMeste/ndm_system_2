# Тестовое задание для ndm system

## Текст тестового
Написать приложение-сервер на C/C++ для GNU/Linux, который асинхронно обрабатывает клиентские подключения по протоколам TCP и UDP с помощью механизма мультиплексирования (на базе epoll) без использования сторонних библиотек.

Если сообщение клиента начинается с символа /, то оно интерпретируется как команда.
 В противном случае зеркалируется клиенту.
 
 Сервер должен поддерживать следующие команды:
 /time — возврат текущего времени и даты в формате "2025-11-10 17:28:45";
 /stats — возврат статистики (общее количество подключившихся клиентов и подключенных в данный момент);
 /shutdown — завершение работы.
 
Преимуществом будет написанный Makefile, systemd unit для запуска и пакет для вашего дистрибутива.
/usr/lib/systemd/system/

## Как пользоваться
Для информации о доступных параметрах вызовите с флагом --help или -h
```bash
ndmserver -h
```

Включить службу при необходимости

```bash
systemctl enable ndm_server.service
```

## Как запустить

### Запуск в docker (рекомандуется)
```bash
docker build -t ndmserver
# По умолчанию порт 1010
docker run -p 1010:1010 -p 1010:1010/udp ndmserver
```

### arch Linux
Скопировать файл [PKGBUILD](install/PKGBUILD) (клонировать репозиторий не обязательно) и собрать пакет
```bash
makepkg -s .
pacman -U ndm-system*.pkg.tar
```

### debian/ubuntu Linux

Скачать [пакет deb](./install) и установить его

```bash
apt-get install ./путь_к_deb
```

### Сборка из исходников
```bash
make
make install
```

## Описание реализации
Задание было выполненно в полном объёме.
Приложение написано на С++ т.к. пользовался ООП. Сервер определён в отдельную статическую библиотеку, собираемую с помощью своего Makefile. В основном Makefile идёт вызов Makefile сервера
[systemd unit](./install/ndm_service.service) устанавливается через make install и через пакеты. Я реализовал пакет для arch, как пакет для своего дистрибутива. Также есть deb пакет для debian/ubuntu из-за популярности этих дистрибутивов
Сервер работает на ipv4. Прослушивает все Ip. По умолчанию порт 1010, но можно изменить с помощью параметра -p. По умолчанию работает в 10 потоках, но можно изменить с помощью параметра -p. Сервер поддерживает прослушивание нескольких портов на udp/tcp прооколах. Добавить можно в функции [main](./src/main.cxx). Команда /stats показывает статистику в виде подключённых_пользователей/всего_пользователей. Пользователь считается подключённым, если он подключался в течении последних 5-ти секунд и не разорвал tcp-подключение. Все udp-пакеты считаются за 1 пользователя, который изначально не подключен
Обработка запросов реализована через middleware's. epoll работает по фронту
