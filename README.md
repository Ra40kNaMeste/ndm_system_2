# Тестовое задание для ndm system
## Задание
Написать приложение-сервер на C/C++ для GNU/Linux, который асинхронно обрабатывает клиентские подключения по протоколам TCP и UDP с помощью механизма мультиплексирования (на базе epoll) без использования сторонних библиотек.

Если сообщение клиента начинается с символа /, то оно интерпретируется как команда.
 В противном случае зеркалируется клиенту.
 
 Сервер должен поддерживать следующие команды:
 /time — возврат текущего времени и даты в формате "2025-11-10 17:28:45";
 /stats — возврат статистики (общее количество подключившихся клиентов и подключенных в данный момент);
 /shutdown — завершение работы.
 
Преимуществом будет написанный Makefile, systemd unit для запуска и пакет для вашего дистрибутива.

## Установка
### docker (рекомендуется)
```bash
docker build -t ndmsystem
docker run -p 1010:1010 -p 1010:1010/udp ndmserver
```

### arch
Скопируйте [сценаций установки](./install/PKGBUILD). Соберите и установите пакет
```bash
makepkg -s .
pacman -U ndm-sysytem-1*.pkg.tar.zst
```

### debian/ubuntu
Скопируйте и установите пакет .deb [отсюда](./install/)
```bash
apt-get install ndmserver*.deb
```

### Сборка из исходников
Склонируйте репозиторий и соберите
```bash
make
make install
```

## Использование
Включите службу
```bash
systemctl start ndm_server.service
```
или вызовите
```bash
ndmserver
```
По умолчанию сервер будет слушать на порту 1010 по TCP и UDP протоколам в 10 потоках. Для отправки сообщения можно использовать утилиту netcat
```bash
echo "message" | nc localhost 1010
```

Для получения большей информации используйте параметр -h
С помощью параметра -p можно сменить порт прослушивания, а с помощью параметра -t можно изменить количество потоков

## Описание реализации
Задание было выполнено в полном объёме. Сервер был полностью написан на С++. epoll используется в режиме реагирования по фронту (edge triggered)
Команды всегда начинаются с '/'. Если команда не найдена, сервер отправит соответсвующую ошибку. Команда /stats возвращает статистику вида 'число_подключенных_пользователей/всего_пользователей'. Пользователь считается подключенным, если он не разорвал tcp соединение и отправил последнее сообщение менее чем 5 секунд назад. В случае udp - пользователь изначально существует, но считается подключенным только если отправил последнее сообщение менее чем 5 секунд назад  
Сервер был написан, как отдельный проект-статическая библиотека со своим [makefile'ом](./NdmServer/Makefile), при сборке проекта из [основного makefile'а](./Makefile) библиотека также собирается. Было принято решение сделать обработку сигнала с помощью middleware'ов, передающих данные запроса и ответа по цепочке обязанностей (паттерн ООП)  

[systemd unit](./install/ndm_service.service) просто вызывает ndmserver без параметров при запуске. Пакет для arch был написан т.к. это моя операционная система. Пакет для debian/ubuntu был написан из-за популярности пакетного менеджера apt. Он был проверен на виртуальной машине  
